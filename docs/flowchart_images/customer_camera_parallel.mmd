%% Customer / camera-level: one pipeline (and backend) per customer or per camera. Recommended for production (many customers/cameras). See threading-and-memory-management.md.
flowchart TD
    subgraph Sources["Input sources"]
        Cam1["ðŸ“· Camera 1"]
        Cam2["ðŸ“· Camera 2"]
        CamN["ðŸ“· Camera N"]
    end

    subgraph Routing["Application: route by camera_id"]
        R1["Pipelineâ‚"]
        R2["Pipelineâ‚‚"]
        RN["Pipelineâ‚™"]
    end

    Cam1 --> R1
    Cam2 --> R2
    CamN --> RN

    R1 --> Run1["run_pipeline(Pipelineâ‚, frame)"]
    R2 --> Run2["run_pipeline(Pipelineâ‚‚, frame)"]
    RN --> RunN["run_pipeline(Pipelineâ‚™, frame)"]

    Run1 --> CB1["Callback(DefectResult)<br/>+ camera_id"]
    Run2 --> CB2["Callback(DefectResult)<br/>+ camera_id"]
    RunN --> CBN["Callback(DefectResult)<br/>+ camera_id"]

    CB1 --> Out["Collect / Alert / Store"]
    CB2 --> Out
    CBN --> Out

    note["Each pipeline used from one thread.<br/>No shared backend; scales by adding pipelines."]
